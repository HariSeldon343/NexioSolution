<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- PWA Essential Meta Tags -->
    <title>Nexio Calendar & Tasks</title>
    <meta name="description" content="Nexio mobile app per gestione calendario e task">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Nexio">
    
    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="./icons/icon-72.svg">
    <link rel="apple-touch-icon" href="./icons/apple-touch-icon.svg">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152.svg">
    
    <!-- Prevent zooming -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- CSS -->
    <link href="./css/app.css" rel="stylesheet">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="./js/app.js" as="script">
    <link rel="preload" href="./css/app.css" as="style">
</head>
<body>
    <!-- Install Banner -->
    <div id="installBanner" class="install-banner d-none">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-8">
                    <div class="d-flex align-items-center">
                        <img src="./icons/icon-72.png" alt="Nexio" width="40" height="40" class="me-3">
                        <div>
                            <h6 class="mb-0">Installa Nexio</h6>
                            <small class="text-muted">Per un'esperienza migliore</small>
                        </div>
                    </div>
                </div>
                <div class="col-4 text-end">
                    <button id="installBtn" class="btn btn-primary btn-sm">
                        Installa
                    </button>
                    <button id="dismissBtn" class="btn btn-link btn-sm p-0 ms-2" aria-label="Chiudi">
                        ✕
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-3">
                    <img src="../assets/images/nexio-logo-simple.svg" alt="Nexio" height="32" class="app-logo">
                </div>
                <div class="col-6 text-center">
                    <h1 class="app-title h5 mb-0">Nexio Mobile</h1>
                </div>
                <div class="col-3 text-end">
                    <div class="dropdown">
                        <button class="btn btn-link p-0" type="button" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                            <li><a class="dropdown-item" href="#" onclick="showProfile()">
                                <i class="fas fa-user me-2"></i>Profilo
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showSettings()">
                                <i class="fas fa-cog me-2"></i>Impostazioni
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
        <div class="container-fluid h-100">
            <!-- Navigation Pills -->
            <div class="nav-pills-container">
                <ul class="nav nav-pills nav-fill mb-3" id="mainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="calendar-tab" data-bs-toggle="pill" data-bs-target="#calendar-pane" type="button" role="tab" aria-controls="calendar-pane" aria-selected="true">
                            <i class="fas fa-calendar-alt me-1"></i>
                            <span>Calendario</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tasks-tab" data-bs-toggle="pill" data-bs-target="#tasks-pane" type="button" role="tab" aria-controls="tasks-pane" aria-selected="false">
                            <i class="fas fa-tasks me-1"></i>
                            <span>Attività</span>
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabContent">
                <!-- Calendar Tab -->
                <div class="tab-pane fade show active" id="calendar-pane" role="tabpanel" aria-labelledby="calendar-tab">
                    <div class="calendar-container">
                        <!-- Calendar Header -->
                        <div class="calendar-header">
                            <div class="row align-items-center mb-3">
                                <div class="col-3">
                                    <button class="btn btn-outline-primary btn-sm" id="prevMonth">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                </div>
                                <div class="col-6 text-center">
                                    <h4 id="currentMonth" class="mb-0"></h4>
                                </div>
                                <div class="col-3 text-end">
                                    <button class="btn btn-outline-primary btn-sm" id="nextMonth">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- View Toggle -->
                            <div class="btn-group w-100 mb-3" role="group" aria-label="Calendar Views">
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="monthView">Mese</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="weekView">Settimana</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="dayView">Giorno</button>
                            </div>
                        </div>

                        <!-- Calendar Grid -->
                        <div id="calendarGrid" class="calendar-grid">
                            <!-- Calendar will be generated by JavaScript -->
                        </div>

                        <!-- Today's Events -->
                        <div class="today-events mt-4">
                            <h5>Oggi</h5>
                            <div id="todayEventsList" class="events-list">
                                <!-- Events will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Tab -->
                <div class="tab-pane fade" id="tasks-pane" role="tabpanel" aria-labelledby="tasks-tab">
                    <div class="tasks-container">
                        <!-- Tasks Header -->
                        <div class="tasks-header mb-3">
                            <div class="row align-items-center">
                                <div class="col-8">
                                    <h4 class="mb-0">Le mie attività</h4>
                                </div>
                                <div class="col-4 text-end">
                                    <button class="btn btn-primary btn-sm" onclick="addNewTask()">
                                        <i class="fas fa-plus me-1"></i>Nuova
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Tasks Filter -->
                        <div class="tasks-filter mb-3">
                            <div class="btn-group w-100" role="group" aria-label="Task Filters">
                                <button type="button" class="btn btn-outline-secondary btn-sm active" data-filter="all">Tutte</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-filter="pending">Da fare</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-filter="completed">Completate</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-filter="overdue">Scadute</button>
                            </div>
                        </div>

                        <!-- Tasks List -->
                        <div id="tasksList" class="tasks-list">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="app-bottom-nav">
        <div class="container-fluid">
            <div class="row">
                <div class="col-6">
                    <button class="nav-btn active" data-target="calendar-pane">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Calendario</span>
                    </button>
                </div>
                <div class="col-6">
                    <button class="nav-btn" data-target="tasks-pane">
                        <i class="fas fa-tasks"></i>
                        <span>Attività</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Caricamento...</span>
            </div>
            <p class="mt-3">Caricamento...</p>
        </div>
    </div>

    <!-- Offline Banner -->
    <div id="offlineBanner" class="offline-banner d-none">
        <div class="container-fluid">
            <div class="text-center py-2">
                <i class="fas fa-wifi me-2"></i>
                <span>Modalità offline attiva</span>
            </div>
        </div>
    </div>

    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- JavaScript -->
    <script src="./js/app.js"></script>
    <script src="./js/calendar.js"></script>
    <script src="./js/tasks.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('PWA: Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('PWA: Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>