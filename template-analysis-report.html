<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Template Analysis Report</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.6; 
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ccc; 
            background-color: #f9f9f9; 
        }
        h1, h2 { color: #333; }
        h1 { border-bottom: 3px solid #007cba; padding-bottom: 10px; }
        h2 { border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .table-info { 
            background: #e8f4f8; 
            padding: 10px; 
            margin: 10px 0; 
            border-left: 4px solid #007cba; 
        }
        .code-block { 
            background: #f4f4f4; 
            padding: 10px; 
            border-radius: 4px; 
            font-family: monospace; 
            overflow-x: auto; 
            font-size: 12px; 
        }
        .finding { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        .important { 
            background: #d4edda; 
            border: 1px solid #c3e6cb; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        ul { padding-left: 20px; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Database Template Analysis Report</h1>
    <p><strong>Analysis Date:</strong> <?php echo date('Y-m-d H:i:s'); ?></p>
    <p><strong>Based on:</strong> SQL Schema Files and PHP Code Analysis</p>

    <div class="section">
        <h2>1. Template-Related Tables Found</h2>
        
        <div class="table-info">
            <h3>Primary Template Table: moduli_template</h3>
            <p>This is the main table storing template data with rich content capabilities.</p>
            
            <h4>Table Structure:</h4>
            <div class="code-block">
CREATE TABLE moduli_template (
    id INT AUTO_INCREMENT PRIMARY KEY,
    modulo_id INT NOT NULL,
    contenuto LONGTEXT,
    tipo ENUM('word', 'excel', 'form') DEFAULT 'word',
    header_content LONGTEXT,
    footer_content LONGTEXT,
    logo_header VARCHAR(255),
    logo_footer VARCHAR(255),
    creato_il TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    aggiornato_il TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (modulo_id) REFERENCES moduli_documento(id) ON DELETE CASCADE
);
            </div>
        </div>

        <div class="table-info">
            <h3>Supporting Table: moduli_documento</h3>
            <p>Defines the document modules/types that templates are associated with.</p>
            
            <h4>Sample Module Types:</h4>
            <ul>
                <li>PROCEDURE - Procedure operative standard</li>
                <li>ISTRUZIONI - Istruzioni operative dettagliate</li>
                <li>MODULI - Moduli compilabili e form</li>
                <li>REGISTRI - Registri di controllo e monitoraggio</li>
                <li>VERBALI - Verbali di riunioni e incontri</li>
                <li>REPORT - Report e analisi</li>
                <li>CONTRATTI - Contratti e accordi</li>
                <li>POLITICHE - Politiche aziendali</li>
                <li>CHECKLIST - Liste di controllo</li>
                <li>COMUNICAZIONI - Comunicazioni interne ed esterne</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>2. Rich Content Template Structure</h2>
        
        <div class="important">
            <h3>Key Finding: Templates Support Rich Headers and Footers</h3>
            <p>The system supports complex templates with:</p>
            <ul>
                <li><strong>Main Content (contenuto):</strong> LONGTEXT field for the document body</li>
                <li><strong>Header Content (header_content):</strong> LONGTEXT field for custom headers</li>
                <li><strong>Footer Content (footer_content):</strong> LONGTEXT field for custom footers</li>
                <li><strong>Header Logo (logo_header):</strong> Path to header logo image</li>
                <li><strong>Footer Logo (logo_footer):</strong> Path to footer logo image</li>
                <li><strong>Template Type (tipo):</strong> word/excel/form format support</li>
            </ul>
        </div>

        <div class="finding">
            <h3>Template Processing System</h3>
            <p>The system includes a sophisticated TemplateProcessor class that supports:</p>
            <ul>
                <li>Dynamic placeholder replacement (e.g., {logo_azienda}, {info_azienda})</li>
                <li>Company information integration</li>
                <li>Document metadata (title, code, version)</li>
                <li>Page numbering and date stamping</li>
                <li>Copyright and contact information</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>3. Template Content Analysis</h2>
        
        <div class="table-info">
            <h3>Default Template Structure (from SQL)</h3>
            <p>The system creates rich HTML templates with:</p>
            
            <h4>Header Section:</h4>
            <div class="code-block">
&lt;div class="header"&gt;
    &lt;h1&gt;{azienda_nome}&lt;/h1&gt;
    &lt;h2&gt;[Document Type]&lt;/h2&gt;
    &lt;p&gt;Documento n. {numero_documento} del {data_documento}&lt;/p&gt;
&lt;/div&gt;
            </div>

            <h4>Content Section:</h4>
            <div class="code-block">
&lt;div class="content"&gt;
    &lt;div class="info-box"&gt;
        &lt;p&gt;&lt;strong&gt;Tipo documento:&lt;/strong&gt; [Type]&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;Codice modulo:&lt;/strong&gt; [Code]&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;h3&gt;Contenuto del documento&lt;/h3&gt;
    [Document Content]
    
    &lt;h3&gt;Informazioni aggiuntive&lt;/h3&gt;
    &lt;ul&gt;
        &lt;li&gt;Azienda: {azienda_nome}&lt;/li&gt;
        &lt;li&gt;Indirizzo: {azienda_indirizzo}&lt;/li&gt;
        &lt;li&gt;Creato da: {utente_nome} {utente_cognome}&lt;/li&gt;
        &lt;li&gt;Data creazione: {data_corrente}&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
            </div>

            <h4>Footer Section:</h4>
            <div class="code-block">
&lt;div class="footer"&gt;
    &lt;p&gt;Documento generato automaticamente dal sistema Nexio&lt;/p&gt;
    &lt;p&gt;&copy; [Year] {azienda_nome} - Tutti i diritti riservati&lt;/p&gt;
&lt;/div&gt;
            </div>
        </div>
    </div>

    <div class="section">
        <h2>4. Company Data Integration</h2>
        
        <div class="table-info">
            <h3>Aziende Table</h3>
            <p>Company information is stored in the 'aziende' table with fields that support rich templates:</p>
            <ul>
                <li><strong>nome:</strong> Company name</li>
                <li><strong>indirizzo:</strong> Company address</li>
                <li><strong>telefono:</strong> Phone number</li>
                <li><strong>email:</strong> Company email</li>
                <li><strong>partita_iva:</strong> VAT number</li>
                <li><strong>codice_fiscale:</strong> Tax code</li>
                <li><strong>logo:</strong> Company logo file path</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>5. Template Management System</h2>
        
        <div class="finding">
            <h3>Management Interface</h3>
            <p>The system includes:</p>
            <ul>
                <li><strong>gestione-moduli-template.php:</strong> Main template management interface</li>
                <li><strong>API endpoints:</strong> get-template.php, save-template.php for AJAX operations</li>
                <li><strong>Upload handling:</strong> Logo upload support for header/footer logos</li>
                <li><strong>Visual editor:</strong> Rich template editing capabilities</li>
            </ul>
        </div>

        <div class="important">
            <h3>Template Processing Features</h3>
            <ul>
                <li>Dynamic placeholder replacement system</li>
                <li>Default template generation with company branding</li>
                <li>Support for multiple document types (Word, Excel, Forms)</li>
                <li>Header/Footer customization with logo support</li>
                <li>Company information auto-population</li>
                <li>Page numbering and metadata integration</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>6. Database Query Recommendations</h2>
        
        <div class="important">
            <h3>To Find Rich Template Data, Use These Queries:</h3>
            
            <h4>1. Check Template Tables:</h4>
            <div class="code-block">
SHOW TABLES LIKE '%template%';
SHOW TABLES LIKE '%moduli%';
            </div>

            <h4>2. Check Template Structure:</h4>
            <div class="code-block">
DESCRIBE moduli_template;
DESCRIBE moduli_documento;
            </div>

            <h4>3. Find Templates with Rich Content:</h4>
            <div class="code-block">
SELECT 
    mt.id,
    md.nome as modulo_nome,
    mt.tipo,
    LENGTH(mt.contenuto) as content_length,
    LENGTH(mt.header_content) as header_length,
    LENGTH(mt.footer_content) as footer_length,
    mt.logo_header,
    mt.logo_footer,
    mt.creato_il
FROM moduli_template mt
JOIN moduli_documento md ON mt.modulo_id = md.id
WHERE mt.contenuto IS NOT NULL 
   OR mt.header_content IS NOT NULL 
   OR mt.footer_content IS NOT NULL
ORDER BY mt.creato_il DESC;
            </div>

            <h4>4. Find Company Data for Templates:</h4>
            <div class="code-block">
SELECT id, nome, logo, indirizzo, telefono, email, partita_iva
FROM aziende 
WHERE attivo = 1;
            </div>

            <h4>5. Check for Rich HTML Content:</h4>
            <div class="code-block">
SELECT id, modulo_id, 
    SUBSTRING(contenuto, 1, 200) as content_preview,
    SUBSTRING(header_content, 1, 200) as header_preview,
    SUBSTRING(footer_content, 1, 200) as footer_preview
FROM moduli_template
WHERE contenuto LIKE '%&lt;%' 
   OR header_content LIKE '%&lt;%' 
   OR footer_content LIKE '%&lt;%';
            </div>
        </div>
    </div>

    <div class="section">
        <h2>7. Summary and Conclusions</h2>
        
        <div class="important">
            <h3>Key Findings:</h3>
            <ul>
                <li><strong>Primary Template Storage:</strong> moduli_template table contains the rich template data</li>
                <li><strong>Rich Content Support:</strong> Separate fields for headers, footers, and logos</li>
                <li><strong>Company Integration:</strong> Templates integrate with aziende table for company branding</li>
                <li><strong>Template Types:</strong> Support for Word, Excel, and Form templates</li>
                <li><strong>Processing System:</strong> Sophisticated placeholder replacement system</li>
                <li><strong>Upload Support:</strong> Logo upload functionality for branded templates</li>
            </ul>
        </div>

        <div class="finding">
            <h3>Template Data Location:</h3>
            <p>The rich template data shown in your screenshots is likely stored in:</p>
            <ul>
                <li><strong>moduli_template.header_content:</strong> Complex headers with company info and logos</li>
                <li><strong>moduli_template.footer_content:</strong> Complex footers with copyright and contact info</li>
                <li><strong>moduli_template.contenuto:</strong> Main document template content</li>
                <li><strong>aziende table:</strong> Company information used in templates</li>
            </ul>
        </div>
    </div>
</body>
</html>