<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Test Bottone OnlyOffice Funzionante</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 50px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn-onlyoffice {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        .btn-onlyoffice:hover {
            background: linear-gradient(135deg, #20c997 0%, #28a745 100%);
            transform: scale(1.05);
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Test Bottone OnlyOffice - Fix Applicato</h1>
        
        <div class="status success">
            <h3>Fix Applicato con Successo!</h3>
            <p>Le funzioni <code>editDocument</code> e <code>isDocumentEditable</code> sono ora esposte nello scope globale.</p>
        </div>

        <h2>Test del Bottone (come in filesystem.php):</h2>
        <p>Questo bottone usa lo stesso codice onclick di filesystem.php:</p>
        
        <!-- Bottone identico a quello in filesystem.php -->
        <button class="btn-onlyoffice" 
                onclick="event.stopPropagation(); editDocument(event, 22)" 
                title="Apri con OnlyOffice">
            üìù Modifica Documento ID 22
        </button>

        <h2>Verifica Funzioni:</h2>
        <button class="btn-onlyoffice" onclick="checkFunctions()">
            üîç Verifica Disponibilit√† Funzioni
        </button>

        <div id="results"></div>

        <h2>Codice Aggiunto in filesystem.php:</h2>
        <pre><code>// Esponi le funzioni per l'editor di documenti (riga 911-912)
window.editDocument = editDocument;
window.isDocumentEditable = isDocumentEditable;</code></pre>

        <h2>Come Testare:</h2>
        <ol>
            <li>Apri <a href="/piattaforma-collaborativa/filesystem.php" target="_blank">filesystem.php</a></li>
            <li>Trova un documento Word/Excel/PowerPoint</li>
            <li>Clicca sul bottone verde "Apri con OnlyOffice"</li>
            <li>Dovrebbe aprirsi l'editor OnlyOffice in una nuova scheda</li>
        </ol>
    </div>

    <script>
        // Definizione locale per test (simula filesystem.php)
        function editDocument(event, fileId) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const url = '/piattaforma-collaborativa/onlyoffice-editor.php?id=' + fileId;
            console.log('‚úÖ Apertura OnlyOffice Editor:', url);
            alert('‚úÖ Apertura OnlyOffice Editor per documento ID: ' + fileId + '\n\nURL: ' + url);
            
            // In produzione apre in nuova scheda
            // window.open(url, '_blank');
        }

        function isDocumentEditable(file) {
            // Funzione di test
            return true;
        }

        // Simula l'esposizione globale come in filesystem.php
        window.editDocument = editDocument;
        window.isDocumentEditable = isDocumentEditable;

        function checkFunctions() {
            const results = document.getElementById('results');
            const checks = {
                'window.editDocument': typeof window.editDocument === 'function',
                'window.isDocumentEditable': typeof window.isDocumentEditable === 'function',
                'editDocument (globale)': typeof editDocument === 'function',
                'isDocumentEditable (globale)': typeof isDocumentEditable === 'function'
            };

            let html = '<div class="status success"><h3>Risultati Verifica:</h3><ul>';
            for (const [key, value] of Object.entries(checks)) {
                const icon = value ? '‚úÖ' : '‚ùå';
                html += `<li>${icon} ${key}: ${value ? 'Disponibile' : 'Non trovata'}</li>`;
            }
            html += '</ul></div>';

            results.innerHTML = html;
            console.log('Verifica funzioni:', checks);
        }

        // Auto-check al caricamento
        window.addEventListener('load', () => {
            console.log('‚úÖ Pagina caricata - Funzioni disponibili:');
            console.log('- window.editDocument:', typeof window.editDocument);
            console.log('- window.isDocumentEditable:', typeof window.isDocumentEditable);
        });
    </script>
</body>
</html>